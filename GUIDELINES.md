# Laravel開発・レビューガイドライン

## 📚 目次
1. [基本原則](#基本原則)
2. [開発ルール](#開発ルール)
3. [コードレビュー](#コードレビュー)
4. [セキュリティガイドライン](#セキュリティガイドライン)
5. [パフォーマンス最適化](#パフォーマンス最適化)

## 基本原則

### コーディング規約
- PSR-12に準拠したコーディングスタイル
- PHP 8.1以上の機能を積極的に活用
- 厳格な型付けの使用（`declare(strict_types=1);`）
- 意味のある変数名・メソッド名の使用
- ディレクトリ名は小文字＋ダッシュ形式

### アーキテクチャ設計
- SOLID原則の遵守
- クリーンアーキテクチャの採用
- 依存性注入とサービスコンテナの活用
- ドメイン駆動設計（DDD）の考え方を取り入れる

## 開発ルール

### ディレクトリ構造
```
app/
├── Console/          # Artisanコマンド
├── Http/
│   ├── Controllers/  # コントローラー
│   ├── Middleware/   # ミドルウェア
│   └── Requests/     # フォームリクエスト
├── Models/           # Eloquentモデル
├── Services/         # ビジネスロジック
├── Repositories/     # データアクセス層
└── Providers/        # サービスプロバイダー
```

### コード品質
- 単一責任の原則を守る
- メソッドは20行以内を目標
- 深いネストを避ける（最大3階層まで）
- コメントは必要最小限に
- 型ヒントを必ず使用

### データベース
- マイグレーションファイルの命名規則を遵守
- インデックスを適切に設定
- 外部キー制約を活用
- Eloquent ORMを基本とする
- N+1問題を回避

## コードレビュー

### レビュープロセス
1. 自動チェック
   - PHPStan（Level 8）
   - PHP_CodeSniffer
   - Laravel Pint
   - PHPUnit（カバレッジ80%以上）

2. マニュアルレビュー
   - セキュリティチェック
   - パフォーマンス確認
   - ビジネスロジックの検証
   - コードの可読性確認

### レビューコメント形式
```markdown
### 🔍 レビュー項目
- ファイル: `app/Http/Controllers/UserController.php`
- 行数: 24-35
- 優先度: 🔴必須 / 🟡推奨 / 🟢提案

### 📝 内容
問題点や改善提案を具体的に記述

### 💡 改善案
```diff
- 現在のコード
+ 推奨するコード
```

### 🔗 参考リンク
- 関連ドキュメント
- ベストプラクティス
```

## セキュリティガイドライン

### 必須対策
1. 認証・認可
   - Laravel Sanctumの使用
   - ロールベースのアクセス制御
   - パスワードのハッシュ化

2. データ検証
   - FormRequestでのバリデーション
   - XSS対策
   - SQLインジェクション対策

3. CSRF対策
   - CSRFトークンの使用
   - SameSite Cookie設定

## パフォーマンス最適化

### データベース
- Eloquentの適切な使用
  - Eager Loading
  - クエリスコープ
  - キャッシュ

### キャッシュ戦略
- Redis/Memcachedの活用
- キャッシュタグの使用
- 適切なTTL設定

### 非同期処理
- キューの活用
- ジョブのバッチ処理
- スケジュールタスク

## 禁止事項

### 🚫 絶対に避けるべき実装
- 生SQLの使用（特別な理由がない限り）
- グローバル関数の定義
- publicプロパティの使用
- DIコンテナのバイパス
- 環境変数の直接参照
- デバッグコードの本番環境へのデプロイ

### ⚠️ 要注意の実装
- 複雑なクエリビルダーの使用
- サービスプロバイダーの過剰な使用
- ミドルウェアでの重い処理
- セッションへの大量データ保存

## レビュー時の確認項目

### 機能面
- 仕様との整合性
- エッジケースの考慮
- エラーハンドリング
- ログ出力の適切性

### 非機能面
- パフォーマンス影響
- スケーラビリティ
- メンテナンス性
- セキュリティリスク

### テスト
- ユニットテストの網羅性
- 機能テストの充実度
- テストデータの適切性
- モック/スタブの使用方法